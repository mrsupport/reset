<!DOCTYPE html>
<html>
<head>
    <title>Reset Link Page</title>
    <script>
        // Function to remove the link from latest-link.txt
        function removeLink() {
            fetch('./latest-link.txt', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'token your-github-personal-access-token' // Replace with your GitHub token
                },
                body: JSON.stringify({
                    message: 'Remove link',
                    content: '',
                    branch: 'main'
                })
            })
            .then(response => {
                if (response.status === 200) {
                    console.log('Link removed from latest-link.txt');
                } else {
                    console.error('Failed to remove link from latest-link.txt');
                }
            })
            .catch(error => {
                console.error('Error removing link from latest-link.txt:', error);
            });
        }

        // Register the removeLink function to run when the page is closed or refreshed
        window.addEventListener('beforeunload', removeLink);

        function checkForResetLink() {
            fetch('./latest-link.txt')
                .then(response => response.text())
                .then(data => {
                    if (data.trim() !== '') {
                        // Update the link and clear the message
                        document.getElementById('reset-link').innerHTML = `<a href="${data}">Click here to reset</a>`;
                        document.getElementById('message').innerHTML = '';
                    } else {
                        // Display "Waiting for your link..."
                        document.getElementById('reset-link').innerHTML = ''; // Remove the link
                        document.getElementById('message').innerHTML = 'Waiting for your link...';
                    }
                })
                .catch(error => {
                    console.error('Error checking for reset link:', error);
                });
        }

        // Check for reset link initially
        checkForResetLink();

        // Periodically check for reset link (every 5 seconds)
        setInterval(checkForResetLink, 5000);
    </script>
</head>
<body>
    <h1>Reset Link</h1>
    <p id="message">Waiting for your link...</p>
    <p id="reset-link"></p>
</body>
</html>
